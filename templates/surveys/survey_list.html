{% extends 'base.html' %}
{% load static %}

{% block title %}قائمة الاستبيانات{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <h1 class="main-title mb-4 animate__animated animate__fadeInDown">قائمة الاستبيانات <i class="fas fa-list-alt"></i></h1>

    <div class="card shadow-sm mb-4 animate__animated animate__fadeInUp">
        <div class="card-header bg-gradient-primary text-white d-flex justify-content-between align-items-center">
            <h4 class="mb-0"><i class="fas fa-filter"></i> فلاتر البحث</h4>
            <a href="{% url 'surveys:create' %}" class="btn btn-light btn-sm animate__animated animate__pulse animate__infinite">
                <i class="fas fa-plus-circle"></i> إنشاء استبيان جديد
            </a>
        </div>
        <div class="card-body">
            <form method="GET" action="{% url 'surveys:list' %}" class="row g-3 align-items-end">
                <div class="col-md-5">
                    <label for="search" class="form-label">البحث العام</label>
                    <input type="text" class="form-control" id="search" name="search" placeholder="ابحث بالعنوان أو الوصف..." value="{{ search_query|default_if_none:'' }}">
                </div>
                <div class="col-md-4">
                    <label for="status" class="form-label">حالة الاستبيان</label>
                    <select class="form-select" id="status" name="status">
                        <option value="">الكل</option>
                        <option value="active" {% if status_filter == 'active' %}selected{% endif %}>نشط</option>
                        <option value="inactive" {% if status_filter == 'inactive' %}selected{% endif %}>غير نشط</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <button type="submit" class="btn btn-primary w-100"><i class="fas fa-search"></i> بحث</button>
                </div>
            </form>
        </div>
    </div>

    {% if page_obj %}
    <div class="row">
        {% for survey in page_obj %}
        <div class="col-md-6 col-lg-4 mb-4">
            <div class="card survey-card h-100 shadow-sm animate__animated animate__fadeInUp animate__delay-{{ forloop.counter0|add:1 }}s">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title text-primary">{{ survey.title }}</h5>
                    <p class="card-text text-muted flex-grow-1">{{ survey.description|truncatechars:100 }}</p>
                    <ul class="list-group list-group-flush mb-3">
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <i class="fas fa-calendar-alt me-2"></i> تاريخ الإنشاء:
                            <span class="badge bg-secondary">{{ survey.created_at|date:"Y-m-d" }}</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <i class="fas fa-question-circle me-2"></i> عدد الأسئلة:
                            <span class="badge bg-info">{{ survey.questions.count }}</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <i class="fas fa-reply-all me-2"></i> عدد الردود:
                            <span class="badge bg-success">{{ survey.responses.count }}</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <i class="fas fa-paper-plane me-2"></i> مرات الإرسال:
                            <span class="badge bg-warning">{{ survey.sent_count }}</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <i class="fas fa-toggle-on me-2"></i> الحالة:
                            {% if survey.is_active %}
                                <span class="badge bg-success">نشط</span>
                            {% else %}
                                <span class="badge bg-danger">غير نشط</span>
                            {% endif %}
                        </li>
                    </ul>
                    <div class="d-flex justify-content-between mt-auto">
                        <a href="{% url 'surveys:view' pk=survey.pk %}" class="btn btn-outline-success btn-sm flex-grow-1 me-2"><i class="fas fa-eye"></i> عرض</a>
                        <a href="{% url 'surveys:detail' pk=survey.pk %}" class="btn btn-outline-primary btn-sm flex-grow-1 me-2"><i class="fas fa-eye"></i> تفاصيل</a>
                        <a href="{% url 'surveys:update' pk=survey.pk %}" class="btn btn-outline-info btn-sm flex-grow-1 me-2"><i class="fas fa-edit"></i> تعديل</a>
                        <a href="{% url 'surveys:delete' pk=survey.pk %}" class="btn btn-outline-danger btn-sm flex-grow-1"><i class="fas fa-trash-alt"></i> حذف</a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- تضمين ملف تقسيم الصفحات -->
    {% include 'partials/_pagination.html' %}

    {% else %}
    <div class="alert alert-info text-center animate__animated animate__fadeInUp">
        <i class="fas fa-info-circle"></i> لا توجد استبيانات لعرضها حالياً.
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
    $(document).ready(function() {
        // تأثيرات Hover للبطاقات
        $(".survey-card").hover(function() {
            $(this).addClass("shadow-lg").css("transform", "translateY(-5px)");
        }, function() {
            $(this).removeClass("shadow-lg").css("transform", "translateY(0)");
        });
    });
</script>
{% endblock %}

